<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <title>WIDA Objective Builder</title>

</head>
<body>
<header>
  <div class="text-xl font-bold text-gray-900">WIDA Objective Builder</div>
  <nav class="flex space-x-6">
    <a href="#" class="text-gray-700 hover:text-blue-600">Home</a>
    <a href="#" class="text-gray-700 hover:text-blue-600">About</a>
    <a href="#" class="text-gray-700 hover:text-blue-600">Contact</a>
  </nav>
</header>

<main>

<div class="bg-green-800 p-6 flex items-center justify-center">
  <section class="flex items-center justify-center w-full">
    <!-- SAME PARENT -->
    <div class="relative z-10 flex flex-col justify-center w-full">

      <!-- preview -->
      <div id="objective-preview"
        class="flex flex-wrap justify-center items-center gap-x-2 gap-y-1 text-white text-xl font-[Caveat] tracking-normal text-center">
        <span id="who">[who]</span>
        <span>will be able to</span>
        <span id="function">[function]</span>
        <span id="goal">[goal]</span>
        <span>through</span>
        <span id="domain">[domain]</span>
        <span>activities, using</span>
        <span id="forms">[forms/features]</span>
        <span>with</span>
        <span id="supports" class="whitespace-nowrap">[supports]</span>
        <span>.</span>
      </div>
    </div>
  </section>
</div>


     <button id="copy-button"
      class="fixed bottom-8 right-8 opacity-0 pointer-events-none px-4 py-2 bg-white/10 hover:bg-white/20 border border-white/30 rounded-lg text-white text-sm font-medium transition-all duration-500 backdrop-blur-sm">
       Copy Objective
    </button>

  <!-- Agentic AI Floating Helper -->
<div id="agentic-ai-helper"
  class="fixed bottom-6 left-6 bg-white border border-gray-300 shadow-lg rounded-2xl p-4 max-w-xs flex items-start gap-3 animate-fade-in">
  <div class="text-2xl">ðŸ¤–</div>
  <div>
    <p class="text-gray-800 text-sm font-medium mb-2">
      Hey! Want to find articles about your lesson topic?
    </p>
    <button id="agentic-ai-button"
      class="text-sm bg-blue-600 text-white px-3 py-1 rounded-md hover:bg-blue-700 transition-colors">
      Find Articles
    </button>
  </div>
</div>




<nav class="flex items-center justify-center mt-8">
  <ul id="steps" class="flex items-center space-x-6">
    <li>
      <div id="step-0" class="step flex items-center space-x-2 cursor-pointer">
        <span class="text-sm font-semibold uppercase text-gray-900 border-b-2 border-blue-500 pb-1">
          Who?
        </span>
        <span class="text-gray-400">&gt;</span>
      </div>
    </li>

    <li>
      <div id="step-1" class="step flex items-center space-x-2 cursor-pointer">
        <span class="text-sm uppercase text-gray-400 hover:text-gray-600">
          What?
        </span>
        <span class="text-gray-400">&gt;</span>
      </div>
    </li>

    <li>
      <div id="step-2" class="step flex items-center space-x-2 cursor-pointer">
        <span class="text-sm uppercase text-gray-400 hover:text-gray-600">
          Goal
        </span>
        <span class="text-gray-400">&gt;</span>
      </div>
    </li>

    <li>
      <div id="step-3" class="step flex items-center space-x-2 cursor-pointer">
        <span class="text-sm uppercase text-gray-400 hover:text-gray-600">
          Domain
        </span>
        <span class="text-gray-400">&gt;</span>
      </div>
    </li>

    <li>
      <div id="step-4" class="step flex items-center space-x-2 cursor-pointer">
        <span class="text-sm uppercase text-gray-400 hover:text-gray-600">
          Forms
        </span>
        <span class="text-gray-400">&gt;</span>
      </div>
    </li>

    <li>
      <div id="step-5" class="step flex items-center space-x-2 cursor-pointer">
        <span class="text-sm uppercase text-gray-400 hover:text-gray-600">
          Supports
        </span>
        <span class="text-gray-400">&gt;</span>
      </div>
    </li>
    <li>
      <div id="step-6" class="step flex items-center space-x-2 cursor-pointer">
        <span class="text-sm uppercase text-gray-400 hover:text-gray-600">
          Finished LO
        </span>
      </div>
    </li>
  </ul>
</nav>


<div id="sidebar-section" class="hidden flex min-h-screen mt-20">
   <div class="w-64 bg-gray-50 border-r border-gray-200 text-gray-800">
     <p id="sidebar-title" class="px-4 pt-4 text-sm font-semibold text-gray-700"></p>
       <p class="px-4 pt-4 text-xs text-gray-500 italic">Based on WIDA Rubrics</p>
    <div id="sidebar-content" class="p-4">
      <!-- dynamic content goes here -->
    </div>
  </div>

  <div id="dynamic-panel" class="flex-1 bg-white p-10"></div>
</div>

  <div id="full-panel" class="hidden bg-white p-10"></div>

  <div id="who-example" class="hidden example-hint-who">
    <div class="example-carousel flex items-center justify-center space-x-4" data-type="who">
      <button onclick="prevExample(this)" class="p-2 text-gray-400 hover:text-gray-600">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
    </button>

      <div class="text-gray-500">
        <span class="italic">Example:</span>
        <span class="example-text font-semibold text-gray-700"></span>
      </div>

      <button onclick="nextExample(this)" class="p-2 text-gray-400 hover:text-gray-600">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </button>
  </div>
</div>

 <button
  id="next-button"
  class="fixed bottom-8 right-8 px-6 py-2 bg-orange-400 hover:bg-orange-500 text-white font-semibold rounded-md shadow-md transition-colors duration-300"
  onclick="goForward()">
  Next &raquo;
</button>



  <div id="goal-example" class="hidden example-hint-goal">
  <div class="example-carousel flex items-center justify-center space-x-4" data-type="goal">
    <button onclick="prevExample(this)" class="p-2 text-gray-400 hover:text-gray-600">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
    </button>

    <div class="text-gray-500">
      <span class="italic">Example:</span>
      <span class="example-text font-semibold text-gray-700"></span>
    </div>

    <button onclick="nextExample(this)" class="p-2 text-gray-400 hover:text-gray-600">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </button>
  </div>
</div>



</main>

<!-- ================= SCRIPTS ================= -->
<script>
document.getElementById('copy-button').addEventListener('click', async() =>{
  let text = document.getElementById('objective-preview').textContent
    .replace(/\s+/g, ' ')  // replace all multiple spaces/newlines with a single space
    .trim();               // remove leading/trailing spaces
  try{
  await navigator.clipboard.writeText(text)
  const btn =document.getElementById('copy-button');
  const original= btn.innerText;
  btn.innerText= 'Copied';
  setTimeout(() => btn.innerText= original, 2000);
  }catch (err){
  alert('Failed to copy.');
  }
  });
  </script>





<script>
  //examples carosel
const examples = {
who: [
  "7th grade newcomers",
  "Level 2 WIDA speakers",
  "High school ESL students at the Emerging level",
  "Entering, grade 1 students"
],

  goal: [
    "an apartment brochure",
    "a short story",
    "the process of building a rocketship"
  ]
  };

const currentIndex= {who: 0, goal:0};

function updateExample(container) {
  const  type= container.dataset.type;
  const textEl = container.querySelector(".example-text");
  textEl.textContent= examples[type][currentIndex[type]];
}

 function prevExample(btn) {
    const container = btn.closest(".example-carousel");
    const type = container.dataset.type;
    currentIndex[type] = (currentIndex[type] - 1 + examples[type].length) % examples[type].length;
    updateExample(container);
  }

  function nextExample(btn) {
    const container = btn.closest(".example-carousel");
    const type = container.dataset.type;
    currentIndex[type] = (currentIndex[type] + 1) % examples[type].length;
    updateExample(container);
  }

  document.querySelectorAll(".example-carousel").forEach(c => updateExample(c));
</script>


<script>
 function clearDynamicPanel() {
  const panel = document.getElementById("dynamic-panel");
  if (panel) panel.innerHTML = "";

  // Close all suggestion dropdowns
  document.querySelectorAll(".suggestions-list").forEach(list => {
    list.innerHTML = "";
    list.style.display = "none";
  });
}
</script>


<script>
function canAdvanceFrom(step) {
  switch (step) {
    case 1: // Function step
      return document.getElementById('function').textContent !== '[function]';
    case 3: // Domain step
      return document.getElementById('domain').textContent !== '[domain]';
    case 4: // Forms step
      return document.getElementById('forms').textContent !== '[forms/features]';
    case 5: // Supports step
      return document.getElementById('supports').textContent !== '[supports]';
    default:
      return true; // Step 0 and Goal can always move on
  }
}

</script>
<script>
  function updateSidebar(step) {
  const sidebarSection = document.getElementById('sidebar-section'); // wrapper
  const sidebar = document.getElementById('sidebar-content');        // inner content

  const sidebarTitle = document.getElementById('sidebar-title');


  // Steps that actually need the sidebar
  const sidebarSteps = ['function', 'domain', 'forms', 'supports'];


  if (sidebarSteps.includes(step)) {
    sidebarSection.classList.remove('hidden'); // show
  } else {
    sidebarSection.classList.add('hidden');    // hide
    sidebar.innerHTML = "";                    // clear
    return;                                    // stop
  }

  switch (step) {
    case 'function':
     sidebarTitle.textContent = 'Choose a Function';
      sidebar.innerHTML = `
        <ul class="space-y-4">
          <li><button onclick="showContent('narrate')" class="category-btn w-full text-left px-4 py-2 hover:bg-gray-100">Narrating</button></li>
          <li><button onclick="showContent('inform')"  class="category-btn w-full text-left px-4 py-2 hover:bg-gray-100">Informing</button></li>
          <li><button onclick="showContent('explain')" class="category-btn w-full text-left px-4 py-2 hover:bg-gray-100">Explaining</button></li>
          <li><button onclick="showContent('argue')"   class="category-btn w-full text-left px-4 py-2 hover:bg-gray-100">Arguing</button></li>
        </ul>
      `;
      break;

    case 'domain':
    sidebarTitle.textContent = 'Choose a domain';
      sidebar.innerHTML = `
        <ul class="space-y-4">
          <li><button onclick="showDomain('interpretive')" class="category-btn w-full text-left px-4 py-2 hover:bg-gray-100">Interpretive</button></li>
          <li><button onclick="showDomain('expressive')"   class="category-btn w-full text-left px-4 py-2 hover:bg-gray-100">Expressive</button></li>
        </ul>
      `;
      break;

      case 'forms':
      sidebarTitle.textContent = 'Choose a form';
      sidebar.innerHTML = `
        <ul class="space-y-4">
          <li><button onclick="showForms('structure')" class="category-btn w-full text-left px-4 py-2 hover:bg-gray-100">Structure</button></li>
          <li><button onclick="showForms('descriptive-language')"   class="category-btn w-full text-left px-4 py-2 hover:bg-gray-100">Descriptive Language</button></li>
          <li><button onclick="showForms('transitions')"   class="category-btn w-full text-left px-4 py-2 hover:bg-gray-100">Transitions</button></li>
          <li><button onclick="showForms('adverbs')"   class="category-btn w-full text-left px-4 py-2 hover:bg-gray-100">adverbs</button></li>
        </ul>
  `;
    break;

    case 'supports':
    sidebarTitle.textContent = 'Choose a support';
      sidebar.innerHTML = `
        <ul class="space-y-4">
          <li><button onclick="showSupports('sensory-supports')" class="category-btn w-full text-left px-4 py-2 hover:bg-gray-100">sensory-supports</button></li>
          <li><button onclick="showSupports('graphic-supports')"   class="category-btn w-full text-left px-4 py-2 hover:bg-gray-100">graphic-supports</button></li>
          <li><button onclick="showSupports('interactive-supports')"  class="category-btn w-full text-left px-4 py-2 hover:bg-gray-100">interactive-supports</button></li>
        </ul>
      `;
      break;

    default:
      sidebar.innerHTML = `<p class="text-gray-500 p-4">Start Here</p>`;
  }
}

</script>

<script>
function toggleSidebar() {
  document.getElementById('sidebar-section').classList.toggle('hidden');
}
</script>

<script>
  function hideSidebar() {
  document.getElementById('sidebar-section').classList.add('hidden');
}
</script>
<!-- General update/set/next -->
<script>
function updateField(fieldId, value) {
  const span = document.getElementById(fieldId);
  if (span) span.textContent = value || `[${fieldId}]`;
}

function setValue(fieldId, value) {
  const span = document.getElementById(fieldId);
  if (span) {
    if (fieldId === "domain") {
  span.textContent = value;
} else {
  span.textContent = value;
}
  }
}

</script>

<script>
function showWhoInput(targetId = "dynamic-panel")  {
  const panel = document.getElementById(targetId);
  panel.innerHTML = `
    <div class="flex flex-col space-y-2">
      <div class="flex items-center space-x-2">
        <input
          type="text"
          id="who-input"
          placeholder="Type who here..."
          class="w-full px-3 py-2 border rounded-md"
          oninput="updateField('who', this.value); fetchSuggestions(this.value, 'who-suggestions', 'who')"
        />
        <span
          title="WIDA Levels:
1 â€“ Entering
2 â€“ Emerging
3 â€“ Developing
4 â€“ Expanding
5 â€“ Bridging
6 â€“ Reaching"
          style="cursor: help; font-size: 1.2em;"
        >&#9432;</span>
      </div>

      <div class="suggestions-container relative">
        <ul id="who-suggestions" class="suggestions-list absolute z-50 bg-white border border-gray-300 shadow-lg w-full"></ul>
      </div>
    </div>
  `;

    document.getElementById("who-example").classList.remove("hidden");


}
</script>


<!-- Custom verb -->
<script>
function showCustomVerbInput() {
  document.getElementById("customVerbContainer").style.display = "block";
}
function useCustomVerb() {
  const verb = document.getElementById("customVerb").value.trim();
  if (verb) {
    document.getElementById("function").textContent = verb;
    document.getElementById("customVerbContainer").style.display = "none";
    document.getElementById("customVerb").value = "";
  }
}
</script>

<script>
function showGoalInput(targetId = "dynamic-panel") {
  document.getElementById("who-example").classList.add("hidden");
  const panel = document.getElementById(targetId);
  panel.innerHTML = `
    <div class="flex flex-col space-y-2">
      <div class="flex items-center space-x-2">
        <input
          type="text"
          id="goal-input"
          placeholder="the pros and cons of ...."
          class="w-full px-3 py-2 border rounded-md"
          oninput="updateField('goal', this.value); fetchSuggestions(this.value, 'goal-suggestions','goal')"
        />
        </div>
      <div class="suggestions-container relative">
        <ul id="goal-suggestions" class="suggestions-list absolute z-50 bg-white border border-gray-300 shadow-lg w-full"></ul>
      </div>
    </div>
  `;
   document.getElementById("goal-example").classList.remove("hidden");
}
</script>



<!-- Custom domain -->
<script>
function showCustomDomainInput() {
  document.getElementById("customDomainContainer").style.display = "block";
}
function useCustomDomain() {
  const domain = document.getElementById("customDomain").value.trim();
  if (domain) {
    document.getElementById("domain").textContent = domain;
    document.getElementById("customDomainContainer").style.display = "none";
    document.getElementById("customDomain").value = "";
  }
}
</script>

<!-- Custom forms -->
<script>
function showCustomFormsInput() {
  document.getElementById("customFormsContainer").style.display = "block";
}
function useCustomForms() {
  const forms = document.getElementById("customForms").value.trim();
  if (forms) {
    document.getElementById("forms").textContent = forms;
    document.getElementById("customFormsContainer").style.display = "none";
    document.getElementById("customForms").value = "";
  }
}
</script>

<!-- Custom supports -->
<script>
function showCustomSupportsInput() {
  document.getElementById("customSupportsContainer").style.display = "block";
}
function useCustomSupports() {
  const supports = document.getElementById("customSupports").value.trim();
  if (supports) {
    document.getElementById("supports").textContent = supports;
    document.getElementById("customSupportsContainer").style.display = "none";
    document.getElementById("customSupports").value = "";
  }
}
</script>

<!-- Show function verbs -->
<script>
function showContent(type) {
  const panel = document.getElementById("dynamic-panel");
  let verbs = [];
  switch (type) {
    case "narrate": verbs = ["RELATE", "RECALL", "DESCRIBE", "LIST", "ARRANGE", "NARRATE"]; break;
    case "inform":  verbs = ["DEFINE", "IDENTIFY", "LABEL", "LIST", "NAME", "RECOGNIZE", "MATCH", "DUPLICATE", "INFORM"]; break;
    case "explain": verbs = ["CLASSIFY", "CONTRAST", "ILLUSTRATE", "EXPLAIN"]; break;
    case "argue":   verbs = ["PERSUADE", "JUSTIFY", "DEFEND", "PROVE", "ARGUE"]; break;
    default:        verbs = ["No details available."];
  }

  panel.innerHTML = `
    <div class="grid grid-cols-[repeat(auto-fit,minmax(150px,1fr))] gap-4">
      ${verbs.map(v => `
        <button class="bg-blue-200 px-5 py-5 rounded text-center uppercase hover:bg-blue-300"
                onclick="setValue('function','${v.toLowerCase()}');">
          ${v}
        </button>
      `).join("")}
    </div>

    <div class="mt-6  pt-4">
      <label for="customVerb" class="block text-sm font-medium mb-1">Add your own verb:</label>
      <input id="customVerb"
             type="text"
             placeholder="Enter your verb/function"
             class="w-full border rounded p-2"
             oninput="updateField('function', this.value); fetchSuggestions(this.value, 'function-suggestions', 'function')">
      <button class="mt-2 bg-blue-500 text-white px-3 py-1 rounded"
              onclick="useCustomVerb()">Use</button>
      <ul id="function-suggestions" class="suggestions-list mt-2"></ul>
    </div>
  `;
}
</script>


<!-- Show domains -->
<script>
function showDomain(type) {
  const panel = document.getElementById("dynamic-panel");
  let domain = [];
  switch (type) {
    case "interpretive": domain = ["LISTENING", "READING"]; break;
    case "expressive":   domain = ["WRITING", "SPEAKING"]; break;
    default:             domain = ["No details available."];
  }

  panel.innerHTML = `
    ${domain.map(d => `
      <button class="bg-blue-200 px-5 py-5 rounded text-center uppercase hover:bg-blue-300
                     text-center uppercase mr-2 mb-5 truncate rounded-md hover:bg-[#d7e4ea]"
              onclick="setValue('domain','${d.toLowerCase()}')">
        ${d}
      </button>
    `).join("")}

    <div class="mt-4  pt-4">
      <label for="custom-domain" class="block text-sm font-medium mb-1">Add your own:</label>
      <input id="custom-domain"
             type="text"
             placeholder="Enter custom domain"
             class="w-full border rounded p-2"
             oninput="updateField('domain', this.value); fetchSuggestions(this.value, 'domain-suggestions','domain')" />
      <ul id="domain-suggestions" class="suggestions-list mt-2"></ul>
    </div>
  `;
}
</script>

<!-- Show forms -->
<script>
function showForms(type) {
  const panel = document.getElementById("dynamic-panel");
  let forms = [];
  switch (type) {
    case "structure": forms = ["CONCLUDING SENTENCE", "TOPIC SENTENCE(S)"]; break;
    case "grammar": forms = ["MODALS", "NOUNS", "PRONOUNS", "VERBS"]; break;
    case "descriptive-language": forms = ["ADJECTIVES", "FIGURATIVE LANGUAGE"]; break;
    case "transitions": forms = ["CAUSE AND EFFECT", "TRANSITIONS", "SEQUENCING"]; break;
    case "adverbs": forms = ["ADVERBS OF MANNER", "ADVERBS OF TIME"]; break;
    default: forms = ["No details available."];
  }

  panel.innerHTML = `
    <div class="grid grid-cols-[repeat(auto-fit,minmax(150px,1fr))] gap-4">
      ${forms.map(f => `
        <button
          class="bg-blue-200 px-5 py-5 rounded text-center uppercase hover:bg-blue-300
                 text-center uppercase mr-2 mb-5 truncate rounded-md hover:bg-[#d7e4ea]"
          onclick="setValue('forms','${f.toLowerCase()}')">
          ${f}
        </button>
      `).join("")}
    </div>

    <div class="mt-4  pt-4">
      <label for="custom-forms" class="block text-sm font-medium mb-1">Add your own:</label>
      <input id="custom-forms"
             type="text"
             placeholder="Enter custom form"
             class="w-full border rounded p-2"
             oninput="updateField('forms', this.value); fetchSuggestions(this.value, 'forms-suggestions','forms')" />
      <ul id="forms-suggestions" class="suggestions-list mt-2"></ul>
    </div>
  `;
}
</script>


<!-- Show supports -->
<script>
function showSupports(type) {
  const panel = document.getElementById("dynamic-panel");
  let supports = [];
  switch (type) {
    case "sensory-supports": supports = ["REALIA", "MANIPULATIVES"]; break;
    case "graphic-supports": supports = ["CHARTS", "T-CHARTS", "GRAPHIC ORGANIZERS", "TIMELINES"]; break;
    case "interactive-supports": supports = ["PARTNER WORK", "SMALL GROUP WORK"]; break;
    default: supports = ["No details available."];
  }

  panel.innerHTML = `
    <div class="grid grid-cols-[repeat(auto-fit,minmax(150px,1fr))] gap-4">
      ${supports.map(s => `
        <button class="bg-blue-200 px-5 py-5 rounded text-center uppercase hover:bg-blue-300
                        text-center uppercase mr-2 mb-5 truncate rounded-md hover:bg-[#d7e4ea]"
                onclick="setValue('supports','${s.toLowerCase()}')">
          ${s}
        </button>
      `).join("")}
    </div>

    <div class="mt-4 pt-4">
      <label for="custom-supports" class="block text-sm font-medium mb-1">Add your own:</label>
      <input id="custom-supports"
             type="text"
             placeholder="Enter custom support"
             class="w-full border rounded p-2"
             oninput="updateField('supports', this.value); fetchSuggestions(this.value, 'supports-suggestions','supports')" />
      <ul id="supports-suggestions" class="suggestions-list mt-2"></ul>
    </div>
  `;
}
</script>


<!-- Suggestions -->
<script>
async function fetchSuggestions(inputValue, listId, fieldType) {
  if (!inputValue) {
    document.getElementById(listId).innerHTML = "";
    return;
  }

  const res = await fetch(`/suggest_content?input=${encodeURIComponent(inputValue)}&field=${fieldType}`);
  let suggestions = await res.json();

  // ðŸ”¹ filter before showing
  suggestions = filterSuggestions(suggestions, inputValue);

  showSuggestions(suggestions, listId);
}

// new filter function
function filterSuggestions(suggestions, userInput) {
  return suggestions.filter(s =>
    s.toLowerCase().startsWith(userInput.toLowerCase())
  );
}

function showSuggestions(suggestions, listId) {
  const list = document.getElementById(listId);
  list.innerHTML = "";

  suggestions.forEach(s => {
    const li = document.createElement("li");
    li.textContent = s;
    li.style.cursor = "pointer";

    li.onclick = () => {
      const inputId = listId.replace("-suggestions", "-input");
      document.getElementById(inputId).value = s;

      updateField(inputId.replace("-input",""), s);

      list.innerHTML = "";
    };

    list.appendChild(li);
  });
}
</script>


 <script>
const steps = document.querySelectorAll("#steps .step");
let currentStep = 0;

function nextStep(index) {

if (index !== 0) clearDynamicPanel();

  steps.forEach((step, i) => {
    step.classList.remove("active", "completed", "disabled");

    if (i < index) {
      step.classList.add("completed");
    } else if (i === index) {
      step.classList.add("active");
    } else if (i === index + 1) {
      step.classList.remove("disabled");
    } else {
      step.classList.add("disabled");
    }
  });

  // update the sidebar
    if (index === 0) {
    document.getElementById('sidebar-section').classList.add('hidden');
    document.getElementById('full-panel').classList.remove('hidden');
    showWhoInput("full-panel");
  } else if (index === 1) {
    updateSidebar('function');
  } else if (index === 2) {
    document.getElementById('sidebar-section').classList.add('hidden');
    document.getElementById('full-panel').classList.remove('hidden');
    showGoalInput("full-panel");
  } else if (index === 3) {
    updateSidebar('domain');
  } else if (index === 4) {
    updateSidebar('forms');
  } else if (index === 5) {
    updateSidebar('supports');
  } else if (index === 6) {
  const preview = document.getElementById("objective-preview");
  const objectiveText = preview.innerText.trim();

    fetch('/agentic_detect', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ objective: objectiveText })
  })
  .then(res => res.json())
  .then(data => {
  const aiHelper = document.getElementById("agentic-ai-helper");
  const aiText = aiHelper.querySelector("p");

  // Display short intro
  aiText.textContent = `Hey! Looks like your lesson is about ${data.topic}. Want some related articles?`;

  // Limit to 3 article topics only
  const limited = data.suggestions ? data.suggestions.slice(0, 3) : [];

  // Create a styled list
  const list = document.createElement("ul");
  list.className = "mt-2 list-disc ml-6 text-sm text-gray-700";

  limited.forEach(s => {
    const li = document.createElement("li");

    // Link to a Google search for the suggestion
    const a = document.createElement("a");
    a.href = `https://www.google.com/search?q=${encodeURIComponent(s)}`;
    a.target = "_blank"; // open in new tab
    a.className = "text-blue-600 hover:underline";
    a.textContent = s;

    li.appendChild(a);
    list.appendChild(li);
  });

  // Append below the AI helper
  aiHelper.appendChild(list);
  aiHelper.classList.add("show");
})
.catch(err => console.error('Agentic AI failed:', err));

  const copyBtn = document.getElementById("copy-button");
  copyBtn.classList.add("show");

  const agenticAI = document.getElementById("agentic-ai-helper");
  agenticAI.classList.add("show");

  preview.classList.add("fullscreen-preview", "fade-in");


  // Optional: clear the rest of the UI
  document.querySelector("header").style.display = "none";
  document.querySelector("nav").style.display = "none";
  document.getElementById("sidebar-section").classList.add("hidden");
  document.getElementById("full-panel").classList.add("hidden");
} else {
    updateSidebar('none');
  }
}

// only once at startup
steps.forEach((step, i) => {
  step.addEventListener("click", e => {
    e.preventDefault();
    if (!step.classList.contains("disabled") && canAdvanceFrom(currentStep)) {
      currentStep = i;
      nextStep(i);
    } else if (!canAdvanceFrom(currentStep)) {
      alert("Please complete this step before continuing.");
    }
  });
});

// move forward
function goForward() {
  if (!canAdvanceFrom(currentStep)) {
    alert("Please complete this step before continuing.");
    return;
  }
  if (currentStep < steps.length - 1) {
    currentStep++;
    nextStep(currentStep);
  }
}

// initial call
nextStep(currentStep);


</script>



</body>

<style>
  .step.active {
  display: block;
}
.step.completed {
  display: block;
  opacity: 0.6;
}


  .step.disabled {
  opacity: 0.4;              /* greyed out look */
  pointer-events: none;       /* blocks all clicks */
  cursor: not-allowed;        /* cursor shows blocked hand */
  color: #bbb;                /* lighter text */
}

.step.disabled:hover::after {
  content: "Complete the current step first";
  position: absolute;
  background: #333;
  color: #fff;
  font-size: 0.75rem;
  padding: 2px 6px;
  border-radius: 4px;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  white-space: nowrap;
}

  form.verb ul.verbs {
  display: flex;
  flex-wrap: wrap; /* lets items move to the next line */
  gap: 10px;       /* spacing between items */
  list-style: none; /* removes default bullets */
  padding: 0;
  margin: 0;
}

.suggestions-list {
  transition: visibility 0s 0.2s; /* Hide immediately, but show with a delay (if desired) */
}

#dynamic-panel button {
  min-height: 60px; /* or whatever looks good */
}

.suggestions-list {
  list-style: none;    /* kill bullets */
  margin: 0;           /* reset browser default margin */
  padding: 0;          /* reset browser default padding */
  border: none;        /* make sure no border is showing */
  min-height: 0;       /* donâ€™t reserve space when empty */
}


    header {
  flex: 0 0 72px;        /* lock header height */
  background: #fff;      /* or whatever color */
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  position: relative;    /* no sticky/fixed */
  z-index: 10;
  padding: 0 1rem;
}
main {
  flex: 1 1 auto;        /* main content fills the rest */
  overflow-y: auto;      /* scrolls inside main if too tall */
}

  .example-text {
  cursor: pointer;
  text-decoration: underline;
  transition: color 0.2s ease;
}
.example-text:hover {
  color: #60a5fa; /* Tailwind blue-400 hover effect */
}

  .fullscreen-preview {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: #065f46; /* Tailwindâ€™s bg-green-800 */
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 50;
  transition: all 0.8s ease-in-out;
  font-size: 1rem;
}

.fullscreen-preview span {
  color: white;
  text-decoration: none !important;
}

#objective-preview span::after {
  content: "\00A0";
  display: inline;
}


.fullscreen-preview.fade-in {
  opacity: 0;
  transform: scale(0.9);
  animation: fadeZoomIn 0.8s forwards;
}

@keyframes fadeZoomIn {
  to {
    opacity: 1;
    transform: scale(1);
  }
}

#copy-button {
  opacity: 0;
  pointer-events: none;
  transform: translateY(10px);
  transition: all 0.4s ease;
}

#copy-button.show {
  opacity: 1;
  pointer-events: auto;
  transform: translateY(0);
  transition: all 0.4s ease;
  z-index: 9999;
}

#agentic-ai-helper {
  opacity: 0;
  pointer-events: none;
  transform: translateY(10px);
  transition: all 0.4s ease;
}

#agentic-ai-helper.show {
  opacity: 1;
  pointer-events: auto;
  transform: translateY(0);
  z-index: 9999;
}


  .relative {
    position: relative;
    z-index: auto; /* donâ€™t fix at 10 */
    overflow: visible;
}


</style>

<script>
document.querySelectorAll('.example-carousel').forEach(carousel => {
  const type = carousel.dataset.type; // e.g. "who", "goal"
  const textEl = carousel.querySelector('.example-text');

  textEl.addEventListener('click', () => {
    const currentValue = textEl.textContent.trim();
    const targetSpan = document.getElementById(type);

    if (targetSpan) targetSpan.textContent = currentValue;

<!--    // ðŸ§¹ Hide the example box once clicked-->
<!--    carousel.parentElement.classList.add('hidden');-->

<!--    // âœ¨ Quick yellow flash for confirmation-->
<!--    targetSpan.classList.add('bg-yellow-200');-->
<!--    setTimeout(() => targetSpan.classList.remove('bg-yellow-200'), 400);-->

<!--    // ðŸ”œ Automatically advance to next step (optional)-->
<!--    if (typeof goForward === 'function') goForward();-->
  });
});
</script>


<script>
document.getElementById("agentic-ai-button").addEventListener("click", async () => {
  const aiText = document.querySelector("#agentic-ai-helper p");
  const topic = aiText.textContent.match(/about (.*?)\./)?.[1] || "";

  try {
    const res = await fetch("/find_articles", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ topic })
    });
    const data = await res.json();

    aiText.textContent = "Here are some ideas:";
    const list = document.createElement("ul");
    list.className = "mt-2 list-disc ml-6 text-sm text-gray-700";

    data.articles.forEach(article => {
      const li = document.createElement("li");
      const a = document.createElement("a");
      a.href = article.url;
      a.textContent = article.title;
      a.target = "_blank";
      a.className = "text-blue-600 hover:underline";
      li.appendChild(a);
      list.appendChild(li);
    });

    aiText.insertAdjacentElement("afterend", list);
  } catch (err) {
    console.error("Error fetching articles:", err);
    aiText.textContent = "Sorry, couldnâ€™t load articles right now.";
  }
});
</script>




</html>
